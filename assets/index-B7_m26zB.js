import{g as pt}from"./_commonjsHelpers-Cpj98o6Y.js";import{k as bt,s as ft}from"./select-or-matches-C9E_1WAJ.js";import{b as Et,c as ht}from"./config-BpWtFwiV.js";import{s as mt}from"./sanitizer-BtXph-xc.js";import{e as St}from"./events-C6LRLXdn.js";const U=bt,Lt=ft,At=Et,V=mt,{prefix:Tt}=ht,{CLICK:_t}=St,h=`${Tt}-combo-box`,g=`${h}--pristine`,Q=`${h}__select`,J=`${h}__input`,P=`${h}__clear-input`,$t=`${P}__wrapper`,gt=`${h}__input-button-separator`,D=`${h}__toggle-list`,xt=`${D}__wrapper`,Y=`${h}__list`,O=`${h}__list-option`,_=`${O}--focused`,Z=`${O}--selected`,tt=`${h}__status`,L=`.${h}`,Ot=`.${Q}`,v=`.${J}`,et=`.${P}`,st=`.${D}`,Ct=`.${Y}`,y=`.${O}`,ot=`.${_}`,It=`.${Z}`,Bt=`.${tt}`,vt=".*{{query}}.*",yt=()=>{},S=(s,t="")=>{const e=s;e.value=t;const o=new CustomEvent("change",{bubbles:!0,cancelable:!0,detail:{value:t}});e.dispatchEvent(o)},d=s=>{const t=s.closest(L);if(!t)throw new Error(`Element is missing outer ${L}`);const e=t.querySelector(Ot),o=t.querySelector(v),n=t.querySelector(Ct),i=t.querySelector(Bt),a=t.querySelector(ot),c=t.querySelector(It),r=t.querySelector(st),f=t.querySelector(et),b=t.classList.contains(g),u=t.dataset.disableFiltering==="true";return{comboBoxEl:t,selectEl:e,inputEl:o,listEl:n,statusEl:i,focusedOptionEl:a,selectedOptionEl:c,toggleListBtnEl:r,clearInputBtnEl:f,isPristine:b,disableFiltering:u}},nt=s=>{const{inputEl:t,toggleListBtnEl:e,clearInputBtnEl:o}=d(s);o.hidden=!0,o.disabled=!0,e.disabled=!0,t.disabled=!0},wt=s=>{const{inputEl:t,toggleListBtnEl:e,clearInputBtnEl:o}=d(s);o.hidden=!0,o.setAttribute("aria-disabled",!0),e.setAttribute("aria-disabled",!0),t.setAttribute("aria-disabled",!0)},Ft=s=>{const{inputEl:t,toggleListBtnEl:e,clearInputBtnEl:o}=d(s);o.hidden=!1,o.disabled=!1,e.disabled=!1,t.disabled=!1},W=s=>{const t=s.closest(L);if(t.dataset.enhanced)return;const e=t.querySelector("select");if(!e)throw new Error(`${L} is missing inner select`);const o=e.id,n=document.querySelector(`label[for="${o}"]`),i=`${o}--list`,a=`${o}-label`,c=[],{defaultValue:r}=t.dataset,{placeholder:f}=t.dataset;let b;if(f&&c.push({placeholder:f}),r)for(let p=0,A=e.options.length;p<A;p+=1){const E=e.options[p];if(E.value===r){b=E;break}}if(!n||!n.matches(`label[for="${o}"]`))throw new Error(`${L} for ${o} is either missing a label or a "for" attribute`);n.setAttribute("id",a),n.setAttribute("id",a),e.setAttribute("aria-hidden","true"),e.setAttribute("tabindex","-1"),e.classList.add("usa-sr-only",Q),e.id="",e.value="",["required","aria-label","aria-labelledby"].forEach(p=>{if(e.hasAttribute(p)){const A=e.getAttribute(p);c.push({[p]:A}),e.removeAttribute(p)}});const u=document.createElement("input");if(u.setAttribute("id",o),u.setAttribute("aria-owns",i),u.setAttribute("aria-controls",i),u.setAttribute("aria-autocomplete","list"),u.setAttribute("aria-expanded","false"),u.setAttribute("autocapitalize","off"),u.setAttribute("autocomplete","off"),u.setAttribute("class",J),u.setAttribute("type","text"),u.setAttribute("role","combobox"),c.forEach(p=>Object.keys(p).forEach(A=>{const E=V.escapeHTML`${p[A]}`;u.setAttribute(A,E)})),t.insertAdjacentElement("beforeend",u),t.insertAdjacentHTML("beforeend",V.escapeHTML`
    <span class="${$t}" tabindex="-1">
        <button type="button" class="${P}" aria-label="Clear the select contents">&nbsp;</button>
      </span>
      <span class="${gt}">&nbsp;</span>
      <span class="${xt}" tabindex="-1">
        <button type="button" tabindex="-1" class="${D}" aria-label="Toggle the dropdown list">&nbsp;</button>
      </span>
      <ul
        tabindex="-1"
        id="${i}"
        class="${Y}"
        role="listbox"
        aria-labelledby="${a}"
        hidden>
      </ul>
      <div class="${tt} usa-sr-only" role="status"></div>`),b){const{inputEl:p}=d(t);S(e,b.value),S(p,b.text),t.classList.add(g)}e.disabled&&(nt(t),e.disabled=!1),e.hasAttribute("aria-disabled")&&(wt(t),e.removeAttribute("aria-disabled")),t.dataset.enhanced="true"},C=(s,t,{skipFocus:e,preventScroll:o}={})=>{const{inputEl:n,listEl:i,focusedOptionEl:a}=d(s);if(a&&(a.classList.remove(_),a.setAttribute("tabIndex","-1")),t){if(n.setAttribute("aria-activedescendant",t.id),t.setAttribute("tabIndex","0"),t.classList.add(_),!o){const c=t.offsetTop+t.offsetHeight,r=i.scrollTop+i.offsetHeight;c>r&&(i.scrollTop=c-i.offsetHeight),t.offsetTop<i.scrollTop&&(i.scrollTop=t.offsetTop)}e||t.focus({preventScroll:o})}else n.setAttribute("aria-activedescendant",""),n.focus()},it=(s,t="",e={})=>{const o=i=>i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");let n=s.replace(/{{(.*?)}}/g,(i,a)=>{const c=a.trim(),r=e[c];if(c!=="query"&&r){const f=new RegExp(r,"i"),b=t.match(f);return b?o(b[1]):""}return o(t)});return n=`^(?:${n})$`,new RegExp(n,"i")},x=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o,listEl:n,statusEl:i,isPristine:a,disableFiltering:c}=d(s);let r,f;const b=`${n.id}--option-`,u=(o.value||"").toLowerCase(),p=t.dataset.filter||vt,A=it(p,u,t.dataset);let E=[];const M=[],H=[],lt=[...e.options],at=l=>{if(c||a){E.push(l);return}l.text.toLowerCase().startsWith(u)?M.push(l):H.push(l),E=[...M,...H]},k=l=>A.test(l.text),rt=l=>l.value&&(c||a||!u||k(l)),ct=l=>c&&!f&&k(l),ut=l=>e.value&&l.value===e.value;lt.forEach(l=>{if(rt(l)){at(l);const T=`${b}${E.indexOf(l)}`;ct(l)&&(f=T),ut(l)&&(r=T)}});const I=E.length,dt=E.map((l,T)=>{const j=`${b}${T}`,F=[O];let N="-1",G="false";j===r&&(F.push(Z,_),N="0",G="true"),!r&&T===0&&(F.push(_),N="0");const m=document.createElement("li");return m.setAttribute("aria-setsize",E.length),m.setAttribute("aria-posinset",T+1),m.setAttribute("aria-selected",G),m.setAttribute("id",j),m.setAttribute("class",F.join(" ")),m.setAttribute("tabindex",N),m.setAttribute("role","option"),m.setAttribute("data-value",l.value),m.textContent=l.text,m}),w=document.createElement("li");w.setAttribute("class",`${O}--no-results`),w.textContent="No results found",n.hidden=!1,I?(n.innerHTML="",dt.forEach(l=>n.insertAdjacentElement("beforeend",l))):(n.innerHTML="",n.insertAdjacentElement("beforeend",w)),o.setAttribute("aria-expanded","true"),i.textContent=I?`${I} result${I>1?"s":""} available.`:"No results.";let B;a&&r?B=n.querySelector(`#${r}`):c&&f&&(B=n.querySelector(`#${f}`)),B&&C(n,B,{skipFocus:!0})},$=s=>{const{inputEl:t,listEl:e,statusEl:o,focusedOptionEl:n}=d(s);o.innerHTML="",t.setAttribute("aria-expanded","false"),t.setAttribute("aria-activedescendant",""),n&&n.classList.remove(_),e.scrollTop=0,e.hidden=!0},q=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o}=d(s);S(e,s.dataset.value),S(o,s.textContent),t.classList.add(g),$(t),o.focus()},Nt=s=>{const{comboBoxEl:t,listEl:e,selectEl:o,inputEl:n}=d(s),i=!e.hidden;o.value&&S(o),n.value&&S(n),t.classList.remove(g),i&&x(t),n.focus()},R=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o}=d(s),n=e.value,i=(o.value||"").toLowerCase();if(n)for(let a=0,c=e.options.length;a<c;a+=1){const r=e.options[a];if(r.value===n){i!==r.text&&S(o,r.text),t.classList.add(g);return}}i&&S(o)},Ut=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o,statusEl:n}=d(s);n.textContent="";const i=(o.value||"").toLowerCase();if(i)for(let a=0,c=e.options.length;a<c;a+=1){const r=e.options[a];if(r.text.toLowerCase()===i){S(e,r.value),S(o,r.text),t.classList.add(g);return}}R(t)},Pt=s=>{const{comboBoxEl:t,inputEl:e}=d(s.target);$(t),R(t),e.focus()},z=s=>{const{comboBoxEl:t,listEl:e}=d(s.target);e.hidden&&x(t);const o=e.querySelector(ot)||e.querySelector(y);o&&C(t,o),s.preventDefault()},Dt=s=>{const{comboBoxEl:t,listEl:e}=d(s.target),o=!e.hidden;Ut(t),o&&$(t),s.preventDefault()},X=s=>{const t=s.target,e=t.nextSibling;e&&C(t,e),s.preventDefault()},qt=s=>{q(s.target),s.preventDefault()},Rt=s=>{q(s.target),s.preventDefault()},K=s=>{const{comboBoxEl:t,listEl:e,focusedOptionEl:o}=d(s.target),n=o&&o.previousSibling,i=!e.hidden;C(t,n),i&&s.preventDefault(),n||$(t)},Mt=s=>{s.classList.contains(_)||C(s,s,{preventScroll:!0})},Ht=s=>{const{comboBoxEl:t,listEl:e,inputEl:o}=d(s);e.hidden?x(t):$(t),o.focus()},kt=s=>{const{comboBoxEl:t,listEl:e}=d(s);e.hidden&&x(t)},jt=At({[_t]:{[v](){this.disabled||kt(this)},[st](){this.disabled||Ht(this)},[y](){this.disabled||q(this)},[et](){this.disabled||Nt(this)}},focusout:{[L](s){this.contains(s.relatedTarget)||(R(this),$(this))}},keydown:{[L]:U({Escape:Pt}),[v]:U({Enter:Dt,ArrowDown:z,Down:z}),[y]:U({ArrowUp:K,Up:K,ArrowDown:X,Down:X,Enter:Rt," ":qt,"Shift+Tab":yt})},input:{[v](){this.closest(L).classList.remove(g),x(this)}},mouseover:{[y](){Mt(this)}}},{init(s){Lt(L,s).forEach(t=>{W(t)})},getComboBoxContext:d,enhanceComboBox:W,generateDynamicRegExp:it,disable:nt,enable:Ft,displayList:x,hideList:$,COMBO_BOX_CLASS:h});var Gt=jt;const Qt=pt(Gt);export{Qt as c,Gt as s};
