import{g as nt}from"./_commonjsHelpers-BosuxZz1.js";import{k as it}from"./index-D6IA0wpC.js";import{s as lt}from"./select-or-matches-Bu-g4rUn.js";import{b as at,c as rt}from"./config-BXli1stc.js";import{s as ct}from"./sanitizer-BtXph-xc.js";import{e as ut}from"./events-C6LRLXdn.js";const P=it,dt=lt,pt=at,k=ct,{prefix:bt}=rt,{CLICK:ft}=ut,f=`${bt}-combo-box`,x=`${f}--pristine`,X=`${f}__select`,W=`${f}__input`,U=`${f}__clear-input`,Et=`${U}__wrapper`,ht=`${f}__input-button-separator`,q=`${f}__toggle-list`,mt=`${q}__wrapper`,K=`${f}__list`,C=`${f}__list-option`,$=`${C}--focused`,J=`${C}--selected`,Q=`${f}__status`,A=`.${f}`,St=`.${X}`,y=`.${W}`,Y=`.${U}`,Z=`.${q}`,Lt=`.${K}`,F=`.${C}`,tt=`.${$}`,At=`.${J}`,Tt=`.${Q}`,_t=".*{{query}}.*",$t=()=>{},m=(s,t="")=>{const e=s;e.value=t;const o=new CustomEvent("change",{bubbles:!0,cancelable:!0,detail:{value:t}});e.dispatchEvent(o)},c=s=>{const t=s.closest(A);if(!t)throw new Error(`Element is missing outer ${A}`);const e=t.querySelector(St),o=t.querySelector(y),n=t.querySelector(Lt),i=t.querySelector(Tt),a=t.querySelector(tt),r=t.querySelector(At),l=t.querySelector(Z),b=t.querySelector(Y),E=t.classList.contains(x),S=t.dataset.disableFiltering==="true";return{comboBoxEl:t,selectEl:e,inputEl:o,listEl:n,statusEl:i,focusedOptionEl:a,selectedOptionEl:r,toggleListBtnEl:l,clearInputBtnEl:b,isPristine:E,disableFiltering:S}},et=s=>{const{inputEl:t,toggleListBtnEl:e,clearInputBtnEl:o}=c(s);o.hidden=!0,o.disabled=!0,e.disabled=!0,t.disabled=!0},gt=s=>{const{inputEl:t,toggleListBtnEl:e,clearInputBtnEl:o}=c(s);o.hidden=!0,o.setAttribute("aria-disabled",!0),e.setAttribute("aria-disabled",!0),t.setAttribute("aria-disabled",!0)},xt=s=>{const{inputEl:t,toggleListBtnEl:e,clearInputBtnEl:o}=c(s);o.hidden=!1,o.disabled=!1,e.disabled=!1,t.disabled=!1},j=s=>{const t=s.closest(A);if(t.dataset.enhanced)return;const e=t.querySelector("select");if(!e)throw new Error(`${A} is missing inner select`);const o=e.id,n=document.querySelector(`label[for="${o}"]`),i=`${o}--list`,a=`${o}-label`,r=`${o}--assistiveHint`,l=[],{defaultValue:b}=t.dataset,{placeholder:E}=t.dataset;let S;if(E&&l.push({placeholder:E}),b)for(let u=0,p=e.options.length;u<p;u+=1){const L=e.options[u];if(L.value===b){S=L;break}}if(!n||!n.matches(`label[for="${o}"]`))throw new Error(`${A} for ${o} is either missing a label or a "for" attribute`);n.setAttribute("id",a),n.setAttribute("id",a),e.setAttribute("aria-hidden","true"),e.setAttribute("tabindex","-1"),e.classList.add("usa-sr-only",X),e.id="",e.value="",["required","aria-label","aria-labelledby"].forEach(u=>{if(e.hasAttribute(u)){const p=e.getAttribute(u);l.push({[u]:p}),e.removeAttribute(u)}});const d=document.createElement("input");if(d.setAttribute("id",o),d.setAttribute("aria-owns",i),d.setAttribute("aria-controls",i),d.setAttribute("aria-autocomplete","list"),d.setAttribute("aria-describedby",r),d.setAttribute("aria-expanded","false"),d.setAttribute("autocapitalize","off"),d.setAttribute("autocomplete","off"),d.setAttribute("class",W),d.setAttribute("type","text"),d.setAttribute("role","combobox"),l.forEach(u=>Object.keys(u).forEach(p=>{const L=k.escapeHTML`${u[p]}`;d.setAttribute(p,L)})),t.insertAdjacentElement("beforeend",d),t.insertAdjacentHTML("beforeend",k.escapeHTML`
    <span class="${Et}" tabindex="-1">
        <button type="button" class="${U}" aria-label="Clear the select contents">&nbsp;</button>
      </span>
      <span class="${ht}">&nbsp;</span>
      <span class="${mt}" tabindex="-1">
        <button type="button" tabindex="-1" class="${q}" aria-label="Toggle the dropdown list">&nbsp;</button>
      </span>
      <ul
        tabindex="-1"
        id="${i}"
        class="${K}"
        role="listbox"
        aria-labelledby="${a}"
        hidden>
      </ul>
      <div class="${Q} usa-sr-only" role="status"></div>
      <span id="${r}" class="usa-sr-only">
        When autocomplete results are available use up and down arrows to review and enter to select.
        Touch device users, explore by touch or with swipe gestures.
      </span>`),S){const{inputEl:u}=c(t);m(e,S.value),m(u,S.text),t.classList.add(x)}e.disabled&&(et(t),e.disabled=!1),e.hasAttribute("aria-disabled")&&(gt(t),e.removeAttribute("aria-disabled")),t.dataset.enhanced="true"},B=(s,t,{skipFocus:e,preventScroll:o}={})=>{const{inputEl:n,listEl:i,focusedOptionEl:a}=c(s);if(a&&(a.classList.remove($),a.setAttribute("tabIndex","-1")),t){if(n.setAttribute("aria-activedescendant",t.id),t.setAttribute("tabIndex","0"),t.classList.add($),!o){const r=t.offsetTop+t.offsetHeight,l=i.scrollTop+i.offsetHeight;r>l&&(i.scrollTop=r-i.offsetHeight),t.offsetTop<i.scrollTop&&(i.scrollTop=t.offsetTop)}e||t.focus({preventScroll:o})}else n.setAttribute("aria-activedescendant",""),n.focus()},st=(s,t="",e={})=>{const o=i=>i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");let n=s.replace(/{{(.*?)}}/g,(i,a)=>{const r=a.trim(),l=e[r];if(r!=="query"&&l){const b=new RegExp(l,"i"),E=t.match(b);return E?o(E[1]):""}return o(t)});return n=`^(?:${n})$`,new RegExp(n,"i")},I=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o,listEl:n,statusEl:i,isPristine:a,disableFiltering:r}=c(s);let l,b;const E=`${n.id}--option-`,S=(o.value||"").toLowerCase(),d=t.dataset.filter||_t,u=st(d,S,t.dataset),p=[];for(let T=0,v=e.options.length;T<v;T+=1){const _=e.options[T],O=`${E}${p.length}`;_.value&&(r||a||!S||u.test(_.text))&&(e.value&&_.value===e.value&&(l=O),r&&!b&&u.test(_.text)&&(b=O),p.push(_))}const L=p.length,ot=p.map((T,v)=>{const _=`${E}${v}`,O=[C];let D="-1",M="false";_===l&&(O.push(J,$),D="0",M="true"),!l&&v===0&&(O.push($),D="0");const h=document.createElement("li");return h.setAttribute("aria-setsize",p.length),h.setAttribute("aria-posinset",v+1),h.setAttribute("aria-selected",M),h.setAttribute("id",_),h.setAttribute("class",O.join(" ")),h.setAttribute("tabindex",D),h.setAttribute("role","option"),h.setAttribute("data-value",T.value),h.textContent=T.text,h}),N=document.createElement("li");N.setAttribute("class",`${C}--no-results`),N.textContent="No results found",n.hidden=!1,L?(n.innerHTML="",ot.forEach(T=>n.insertAdjacentElement("beforeend",T))):(n.innerHTML="",n.insertAdjacentElement("beforeend",N)),o.setAttribute("aria-expanded","true"),i.textContent=L?`${L} result${L>1?"s":""} available.`:"No results.";let w;a&&l?w=n.querySelector(`#${l}`):r&&b&&(w=n.querySelector(`#${b}`)),w&&B(n,w,{skipFocus:!0})},g=s=>{const{inputEl:t,listEl:e,statusEl:o,focusedOptionEl:n}=c(s);o.innerHTML="",t.setAttribute("aria-expanded","false"),t.setAttribute("aria-activedescendant",""),n&&n.classList.remove($),e.scrollTop=0,e.hidden=!0},R=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o}=c(s);m(e,s.dataset.value),m(o,s.textContent),t.classList.add(x),g(t),o.focus()},Ot=s=>{const{comboBoxEl:t,listEl:e,selectEl:o,inputEl:n}=c(s),i=!e.hidden;o.value&&m(o),n.value&&m(n),t.classList.remove(x),i&&I(t),n.focus()},H=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o}=c(s),n=e.value,i=(o.value||"").toLowerCase();if(n)for(let a=0,r=e.options.length;a<r;a+=1){const l=e.options[a];if(l.value===n){i!==l.text&&m(o,l.text),t.classList.add(x);return}}i&&m(o)},It=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o,statusEl:n}=c(s);n.textContent="";const i=(o.value||"").toLowerCase();if(i)for(let a=0,r=e.options.length;a<r;a+=1){const l=e.options[a];if(l.text.toLowerCase()===i){m(e,l.value),m(o,l.text),t.classList.add(x);return}}H(t)},vt=s=>{const{comboBoxEl:t,inputEl:e}=c(s.target);g(t),H(t),e.focus()},G=s=>{const{comboBoxEl:t,listEl:e}=c(s.target);e.hidden&&I(t);const o=e.querySelector(tt)||e.querySelector(F);o&&B(t,o),s.preventDefault()},Ct=s=>{const{comboBoxEl:t,listEl:e}=c(s.target),o=!e.hidden;It(t),o&&g(t),s.preventDefault()},V=s=>{const t=s.target,e=t.nextSibling;e&&B(t,e),s.preventDefault()},Bt=s=>{R(s.target),s.preventDefault()},wt=s=>{R(s.target),s.preventDefault()},z=s=>{const{comboBoxEl:t,listEl:e,focusedOptionEl:o}=c(s.target),n=o&&o.previousSibling,i=!e.hidden;B(t,n),i&&s.preventDefault(),n||g(t)},yt=s=>{s.classList.contains($)||B(s,s,{preventScroll:!0})},Ft=s=>{const{comboBoxEl:t,listEl:e,inputEl:o}=c(s);e.hidden?I(t):g(t),o.focus()},Nt=s=>{const{comboBoxEl:t,listEl:e}=c(s);e.hidden&&I(t)},Dt=pt({[ft]:{[y](){this.disabled||Nt(this)},[Z](){this.disabled||Ft(this)},[F](){this.disabled||R(this)},[Y](){this.disabled||Ot(this)}},focusout:{[A](s){this.contains(s.relatedTarget)||(H(this),g(this))}},keydown:{[A]:P({Escape:vt}),[y]:P({Enter:Ct,ArrowDown:G,Down:G}),[F]:P({ArrowUp:z,Up:z,ArrowDown:V,Down:V,Enter:wt," ":Bt,"Shift+Tab":$t})},input:{[y](){this.closest(A).classList.remove(x),I(this)}},mouseover:{[F](){yt(this)}}},{init(s){dt(A,s).forEach(t=>{j(t)})},getComboBoxContext:c,enhanceComboBox:j,generateDynamicRegExp:st,disable:et,enable:xt,displayList:I,hideList:g,COMBO_BOX_CLASS:f});var Pt=Dt;const jt=nt(Pt);export{jt as c,Pt as s};
