import{g as nt}from"./_commonjsHelpers-BosuxZz1.js";import{k as it,s as lt}from"./select-or-matches-BLLALKpn.js";import{b as at,c as rt}from"./config-BXli1stc.js";import{s as ct}from"./sanitizer-BtXph-xc.js";import{e as ut}from"./events-C6LRLXdn.js";const U=it,dt=lt,pt=at,k=ct,{prefix:bt}=rt,{CLICK:ft}=ut,f=`${bt}-combo-box`,g=`${f}--pristine`,X=`${f}__select`,W=`${f}__input`,D=`${f}__clear-input`,Et=`${D}__wrapper`,ht=`${f}__input-button-separator`,q=`${f}__toggle-list`,mt=`${q}__wrapper`,K=`${f}__list`,C=`${f}__list-option`,_=`${C}--focused`,J=`${C}--selected`,Q=`${f}__status`,L=`.${f}`,St=`.${X}`,w=`.${W}`,Y=`.${D}`,Z=`.${q}`,Lt=`.${K}`,F=`.${C}`,tt=`.${_}`,At=`.${J}`,Tt=`.${Q}`,_t=".*{{query}}.*",$t=()=>{},m=(s,t="")=>{const e=s;e.value=t;const o=new CustomEvent("change",{bubbles:!0,cancelable:!0,detail:{value:t}});e.dispatchEvent(o)},c=s=>{const t=s.closest(L);if(!t)throw new Error(`Element is missing outer ${L}`);const e=t.querySelector(St),o=t.querySelector(w),n=t.querySelector(Lt),i=t.querySelector(Tt),a=t.querySelector(tt),r=t.querySelector(At),l=t.querySelector(Z),b=t.querySelector(Y),p=t.classList.contains(g),u=t.dataset.disableFiltering==="true";return{comboBoxEl:t,selectEl:e,inputEl:o,listEl:n,statusEl:i,focusedOptionEl:a,selectedOptionEl:r,toggleListBtnEl:l,clearInputBtnEl:b,isPristine:p,disableFiltering:u}},et=s=>{const{inputEl:t,toggleListBtnEl:e,clearInputBtnEl:o}=c(s);o.hidden=!0,o.disabled=!0,e.disabled=!0,t.disabled=!0},gt=s=>{const{inputEl:t,toggleListBtnEl:e,clearInputBtnEl:o}=c(s);o.hidden=!0,o.setAttribute("aria-disabled",!0),e.setAttribute("aria-disabled",!0),t.setAttribute("aria-disabled",!0)},xt=s=>{const{inputEl:t,toggleListBtnEl:e,clearInputBtnEl:o}=c(s);o.hidden=!1,o.disabled=!1,e.disabled=!1,t.disabled=!1},j=s=>{const t=s.closest(L);if(t.dataset.enhanced)return;const e=t.querySelector("select");if(!e)throw new Error(`${L} is missing inner select`);const o=e.id,n=document.querySelector(`label[for="${o}"]`),i=`${o}--list`,a=`${o}-label`,r=[],{defaultValue:l}=t.dataset,{placeholder:b}=t.dataset;let p;if(b&&r.push({placeholder:b}),l)for(let d=0,S=e.options.length;d<S;d+=1){const E=e.options[d];if(E.value===l){p=E;break}}if(!n||!n.matches(`label[for="${o}"]`))throw new Error(`${L} for ${o} is either missing a label or a "for" attribute`);n.setAttribute("id",a),n.setAttribute("id",a),e.setAttribute("aria-hidden","true"),e.setAttribute("tabindex","-1"),e.classList.add("usa-sr-only",X),e.id="",e.value="",["required","aria-label","aria-labelledby"].forEach(d=>{if(e.hasAttribute(d)){const S=e.getAttribute(d);r.push({[d]:S}),e.removeAttribute(d)}});const u=document.createElement("input");if(u.setAttribute("id",o),u.setAttribute("aria-owns",i),u.setAttribute("aria-controls",i),u.setAttribute("aria-autocomplete","list"),u.setAttribute("aria-expanded","false"),u.setAttribute("autocapitalize","off"),u.setAttribute("autocomplete","off"),u.setAttribute("class",W),u.setAttribute("type","text"),u.setAttribute("role","combobox"),r.forEach(d=>Object.keys(d).forEach(S=>{const E=k.escapeHTML`${d[S]}`;u.setAttribute(S,E)})),t.insertAdjacentElement("beforeend",u),t.insertAdjacentHTML("beforeend",k.escapeHTML`
    <span class="${Et}" tabindex="-1">
        <button type="button" class="${D}" aria-label="Clear the select contents">&nbsp;</button>
      </span>
      <span class="${ht}">&nbsp;</span>
      <span class="${mt}" tabindex="-1">
        <button type="button" tabindex="-1" class="${q}" aria-label="Toggle the dropdown list">&nbsp;</button>
      </span>
      <ul
        tabindex="-1"
        id="${i}"
        class="${K}"
        role="listbox"
        aria-labelledby="${a}"
        hidden>
      </ul>
      <div class="${Q} usa-sr-only" role="status"></div>`),p){const{inputEl:d}=c(t);m(e,p.value),m(d,p.text),t.classList.add(g)}e.disabled&&(et(t),e.disabled=!1),e.hasAttribute("aria-disabled")&&(gt(t),e.removeAttribute("aria-disabled")),t.dataset.enhanced="true"},B=(s,t,{skipFocus:e,preventScroll:o}={})=>{const{inputEl:n,listEl:i,focusedOptionEl:a}=c(s);if(a&&(a.classList.remove(_),a.setAttribute("tabIndex","-1")),t){if(n.setAttribute("aria-activedescendant",t.id),t.setAttribute("tabIndex","0"),t.classList.add(_),!o){const r=t.offsetTop+t.offsetHeight,l=i.scrollTop+i.offsetHeight;r>l&&(i.scrollTop=r-i.offsetHeight),t.offsetTop<i.scrollTop&&(i.scrollTop=t.offsetTop)}e||t.focus({preventScroll:o})}else n.setAttribute("aria-activedescendant",""),n.focus()},st=(s,t="",e={})=>{const o=i=>i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");let n=s.replace(/{{(.*?)}}/g,(i,a)=>{const r=a.trim(),l=e[r];if(r!=="query"&&l){const b=new RegExp(l,"i"),p=t.match(b);return p?o(p[1]):""}return o(t)});return n=`^(?:${n})$`,new RegExp(n,"i")},O=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o,listEl:n,statusEl:i,isPristine:a,disableFiltering:r}=c(s);let l,b;const p=`${n.id}--option-`,u=(o.value||"").toLowerCase(),d=t.dataset.filter||_t,S=st(d,u,t.dataset),E=[];for(let A=0,I=e.options.length;A<I;A+=1){const T=e.options[A],x=`${p}${E.length}`;T.value&&(r||a||!u||S.test(T.text))&&(e.value&&T.value===e.value&&(l=x),r&&!b&&S.test(T.text)&&(b=x),E.push(T))}const v=E.length,ot=E.map((A,I)=>{const T=`${p}${I}`,x=[C];let P="-1",H="false";T===l&&(x.push(J,_),P="0",H="true"),!l&&I===0&&(x.push(_),P="0");const h=document.createElement("li");return h.setAttribute("aria-setsize",E.length),h.setAttribute("aria-posinset",I+1),h.setAttribute("aria-selected",H),h.setAttribute("id",T),h.setAttribute("class",x.join(" ")),h.setAttribute("tabindex",P),h.setAttribute("role","option"),h.setAttribute("data-value",A.value),h.textContent=A.text,h}),N=document.createElement("li");N.setAttribute("class",`${C}--no-results`),N.textContent="No results found",n.hidden=!1,v?(n.innerHTML="",ot.forEach(A=>n.insertAdjacentElement("beforeend",A))):(n.innerHTML="",n.insertAdjacentElement("beforeend",N)),o.setAttribute("aria-expanded","true"),i.textContent=v?`${v} result${v>1?"s":""} available.`:"No results.";let y;a&&l?y=n.querySelector(`#${l}`):r&&b&&(y=n.querySelector(`#${b}`)),y&&B(n,y,{skipFocus:!0})},$=s=>{const{inputEl:t,listEl:e,statusEl:o,focusedOptionEl:n}=c(s);o.innerHTML="",t.setAttribute("aria-expanded","false"),t.setAttribute("aria-activedescendant",""),n&&n.classList.remove(_),e.scrollTop=0,e.hidden=!0},R=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o}=c(s);m(e,s.dataset.value),m(o,s.textContent),t.classList.add(g),$(t),o.focus()},Ot=s=>{const{comboBoxEl:t,listEl:e,selectEl:o,inputEl:n}=c(s),i=!e.hidden;o.value&&m(o),n.value&&m(n),t.classList.remove(g),i&&O(t),n.focus()},M=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o}=c(s),n=e.value,i=(o.value||"").toLowerCase();if(n)for(let a=0,r=e.options.length;a<r;a+=1){const l=e.options[a];if(l.value===n){i!==l.text&&m(o,l.text),t.classList.add(g);return}}i&&m(o)},It=s=>{const{comboBoxEl:t,selectEl:e,inputEl:o,statusEl:n}=c(s);n.textContent="";const i=(o.value||"").toLowerCase();if(i)for(let a=0,r=e.options.length;a<r;a+=1){const l=e.options[a];if(l.text.toLowerCase()===i){m(e,l.value),m(o,l.text),t.classList.add(g);return}}M(t)},Ct=s=>{const{comboBoxEl:t,inputEl:e}=c(s.target);$(t),M(t),e.focus()},G=s=>{const{comboBoxEl:t,listEl:e}=c(s.target);e.hidden&&O(t);const o=e.querySelector(tt)||e.querySelector(F);o&&B(t,o),s.preventDefault()},Bt=s=>{const{comboBoxEl:t,listEl:e}=c(s.target),o=!e.hidden;It(t),o&&$(t),s.preventDefault()},V=s=>{const t=s.target,e=t.nextSibling;e&&B(t,e),s.preventDefault()},vt=s=>{R(s.target),s.preventDefault()},yt=s=>{R(s.target),s.preventDefault()},z=s=>{const{comboBoxEl:t,listEl:e,focusedOptionEl:o}=c(s.target),n=o&&o.previousSibling,i=!e.hidden;B(t,n),i&&s.preventDefault(),n||$(t)},wt=s=>{s.classList.contains(_)||B(s,s,{preventScroll:!0})},Ft=s=>{const{comboBoxEl:t,listEl:e,inputEl:o}=c(s);e.hidden?O(t):$(t),o.focus()},Nt=s=>{const{comboBoxEl:t,listEl:e}=c(s);e.hidden&&O(t)},Pt=pt({[ft]:{[w](){this.disabled||Nt(this)},[Z](){this.disabled||Ft(this)},[F](){this.disabled||R(this)},[Y](){this.disabled||Ot(this)}},focusout:{[L](s){this.contains(s.relatedTarget)||(M(this),$(this))}},keydown:{[L]:U({Escape:Ct}),[w]:U({Enter:Bt,ArrowDown:G,Down:G}),[F]:U({ArrowUp:z,Up:z,ArrowDown:V,Down:V,Enter:yt," ":vt,"Shift+Tab":$t})},input:{[w](){this.closest(L).classList.remove(g),O(this)}},mouseover:{[F](){wt(this)}}},{init(s){dt(L,s).forEach(t=>{j(t)})},getComboBoxContext:c,enhanceComboBox:j,generateDynamicRegExp:st,disable:et,enable:xt,displayList:O,hideList:$,COMBO_BOX_CLASS:f});var Ut=Pt;const kt=nt(Ut);export{kt as c,Ut as s};
